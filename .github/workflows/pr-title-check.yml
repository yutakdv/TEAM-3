name: PR Title Check

on:
  pull_request_target:
    types: [opened, edited, reopened, synchronize]

jobs:
  validate-title:
    runs-on: ubuntu-latest

    steps:
      - name: Validate PR title
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title;

            // 허용된 type: hotfix, fix, feature, feat, major, release
            const regex = /^:[a-z0-9_+]+:\s*(hotfix|fix|feature|feat|major|release)\s*:\s*.+/;

            if (!regex.test(title)) {
              core.setFailed(`❌ Invalid PR title format: "${title}"

              Expected format:
                :gitmoji: type: description
                :gitmoji: type:description
                
                :gitmoji:type: description
                :gitmoji:type:description
              
              Allowed types:
                hotfix | fix | feature | feat | major | release
              
              Examples:
                :sparkles: feat: add hover effect
                :bug: fix: prevent null pointer exception
                :ambulance: hotfix: resolve crash when paused
                :rocket: release: v1.0.0 stable build
                :boom: major: refactor game engine
                :tada: feature: achievement system added`);
            }
